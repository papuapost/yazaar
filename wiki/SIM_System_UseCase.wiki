#summary SIM Architecture System UseCase (Issue 25)
#labels Phase-Requirements

==Narrative==

Vulcan is ready to setup the skeleton for a new application using a "[ApplicationArchitecture Singleton iFrame Mashup (SIM) Architecture]". 


==Goal==

Architectural Goals
 * Avoid conflicts when utilizing multiple widgets in non-trivial applications
 * Utilize standalone widgets with synergistic features
 * Allow intelligent management of client-state resources
 * Allow widgets to share state as needed 

|| *Level*   || System Component || 
|| *Trigger* || Work on new application to begin  || 
|| *Primary Actor* || Developer ||

==Main Success Scenario (MSS)==

|| *Step* || *Action* ||
|| *1* || Create script hosting the application singletons object.    ||
|| *2* || Define constructors to be shared between widgets.           ||
|| *3* || Define properties and methods to be shared between widgets. ||
|| *4* || Define top-level Menu page. || 
|| *5* || Define top-level Menu widget. || 
|| *6* || Define iframes for each iframe widget managed by Menu. ||
|| *7* || Define Menu page script to manage iframes in response to Menu item changes. ||
|| *8* || Define HTML pages and scripts for each top-level iframe widget. ||

==Extensions==

|| *Step* || *Extension Action*       ||
||        ||                          ||
|| 3a     || _Utilize Custom Events_  ||
|| .1     || Register application custom events with the application singleton.  ||
|| .2     || Define custom event handlers in the widget's page script. ||

==Sample Code==

|| *Step* || Code        ||
|| *1*    || {{{my.js}}} ||

{{{
if (typeof parent.MY != "undefined") {
    var MY = parent.MY; // Application Class namespace
    var my = parent.my; // Application singleton
} else {
    
    var MY = {};
    var my = {};

 // ... 
}
}}}

|| *Step* || Code ||
|| *2*    ||      ||

{{{
    MY.View = function(sName,sTitle) {
        var oView = new YAHOO.widget.Overlay(sName);
        oView.oContent = null;
        my.oViewManager.register(oView);
        my.oViewManager.oViews[sTitle] = oView;
        oView.render();
        return oView;
    };

   MY.Events = function() {
	// ...
    };
    YAHOO.augment(MY.Events, YAHOO.util.EventProvider);
}}}

|| *Step* || Code ||
|| *3*    ||      ||

{{{
    my.info = function(sMessage) {
        YAHOO.log(sMessage,"info");
    };


    my.oViewConfig = {
        width:"800px",
        fixedcenter: false,
        constraintoviewport: true,
        underlay:"shadow",
        close:true,
        visible:true,
        draggable:true
    };

    my.oViewManager = new YAHOO.widget.OverlayManager();
    my.oViewManager.oViews = {};

    my.oEvents = new MY.Events();

}}}

|| *Step* || Code ||
|| *3a1*  || {{{$my.js}}}} ||

{{{
   MY.Events = function() {
        this.createEvent("contactsLoad")
	// ...
    };
}}}

|| *3a2*  || {{{$Page.js}}} ||

{{{
    my.oEvents.onContactsLoadReturn = function(oData) {
        my.info("Firing contactsLoad Event");
        my.oEvents.fireEvent("contactsLoad", oData);
    };
}}}

|| *4*  || {{{$Menu.html}}} ||

{{{
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- 
Copyright (c) 2007, Husted dot Com, Inc. All rights reserved.
Code licensed under the BSD License: http://developer.yahoo.net/yui/license.txt
-->
<html>
    <head>
        <title>Menu</title>
        <link href="http://yui.yahooapis.com/2.2.2/build/tabview/assets/tabview.css" rel="stylesheet" type="text/css" />
        <link href="http://yui.yahooapis.com/2.2.2/build/tabview/assets/border_tabs.css" rel="stylesheet" type="text/css" />
        <link href="my.css" rel="stylesheet" type="text/css" >
        <style type="text/css">
          #Contacts, #Notepad, #Log {display: none}
        </style>
        <script src="http://yui.yahooapis.com/2.2.2/build/yahoo-dom-event/yahoo-dom-event.js" type="text/javascript"></script>
        <script src="http://yui.yahooapis.com/2.2.2/build/element/element-beta-min.js" type="text/javascript"></script>
        <script src="http://yui.yahooapis.com/2.2.2/build/container/container-min.js" type="text/javascript"></script>        
        <script src="http://yui.yahooapis.com/2.2.2/build/tabview/tabview-min.js"type="text/javascript"></script>
        <script src="../../build/extras/crockford/remedial.js" type="text/javascript"></script>
        <script src="my.js" type="text/javascript"></script>
        <script src="Menu.js" type="text/javascript"></script>
    </head>
<body>
    <div id="elHeader" class="hd">
        <div id="elMenu" class="yui-navset">
          <ul class="yui-nav">
            <li class="selected"><a href="Welcome.html" target="Welcome"><em>Welcome</em></a></li>
            <li><a href="Contacts.html" target="Contacts" ><em>Contacts</em></a></li>
            <li><a href="../jsnotes/index.html" target="Notes" ><em>Notes</em></a></li>
            <li><a href="Log.html" target="Log" ><em>Log</em></a></li>
          </ul>
       </div>
    </div>
    <div id="elBody" class="bd">
        <!-- FIXME: Need an overall iframe stylesheet -->
        <iframe src="Welcome.html" name="Welcome" id="Welcome" frameborder="0" marginheight="0" width="1000" height="500" ></iframe>        
        <iframe src="blank.html" name="Contacts" id="Contacts" frameborder="0" marginheight="0" width="1000" height="500" ></iframe> 
        <iframe src="blank.html" name="Notes" id="Notes" frameborder="0" marginheight="0" width="1000" height="500" ></iframe> 
        <iframe src="Log.html" name="Log" id="Log" frameborder="0" marginheight="0" width="1000" height="500" ></iframe> 
     </div>
     <div id="elScript" class="js">
        <script type="text/javascript">
            my.oMenu = new MY.Menu("elMenu", "{sTitle} - Yazaar PIM Example");
            var fnReady = function() {
                my.aFrames = window.frames; // FIXME: Use it or lose it!       
                my.oMenu.setTitle(0);	
            };
            YAHOO.util.Event.onContentReady("elBody",fnReady);        
        </script>
     </div>
    </body>
</html>
}}}


|| *7* || {{{Menu.js}}} ||

{{{
/*
Copyright (c) 2007, Husted dot Com, Inc. All rights reserved.
Code licensed under the BSD License: http://developer.yahoo.net/yui/license.txt
*/
MY.Menu = function(elName,sTitleTemplate) {   
    var sTemplate = sTitleTemplate || "";    
    if (elName) {
        // MY.Menu.superclass.constructor.call(this, elName);
        this.oTabView = new YAHOO.widget.TabView(elName);
        this.oTabView.oMenu = this;
        this.sTitleTemplate = sTemplate;
        this.init();
    } else {
        my.error("Menu: Missing parameter elName. Object not initialized","error");
    }
};

// YAHOO.lang.extend(MY.Menu, YAHOO.widget.TabView); // FIXME: Why doesn't extending work? (or is not extending better?)

MY.Menu.prototype.aFrameTitles = [];

MY.Menu.prototype.initTab = function(nTab, sTitle, sLocation, isLoaded) {
    if (arguments<4) {
        my.error("initTab: All parameters are required!");
        return;
    }
    var oTab = this.oTabView.getTab(nTab); 
    // Extend via expando
    oTab.sTitle = sTitle;
    oTab.sLocation = sLocation;
    oTab.isLoaded = isLoaded;
    this.aFrameTitles.push(sTitle); // FIXME: Should be [nTab]
};

MY.Menu.prototype.setTitle = function(nIndex) {
    var oTab = this.oTabView.getTab(nIndex);
    if (YAHOO.lang.isUndefined(oTab)) {
        my.error("setTitle: No such tab " + n);
        return false;
    }
    if (!oTab.isLoaded) {
        window.frames[oTab.sTitle].location = oTab.sLocation;
        oTab.isLoaded = true;
    }
    var sTitle = oTab.sTitle;
    document.title = this.sTitleTemplate.supplant({sTitle: sTitle}); 
    // YAHOO.util.Dom.setStyle(this.aFrameTitles, 'display', 'non'); // FIXME: Why doesn't an array property work?
    // TODO: Extend ViewManager from OverlayManager and add the iFrame hide/show code
    YAHOO.util.Dom.setStyle(['Welcome', 'Contacts', 'Notes', 'Log'], 'display', 'none'); 
    YAHOO.util.Dom.setStyle(sTitle, 'display', 'block');
    var oView = my.oViewManager.oViews[sTitle];
    if (oView) oView.focus();    
    return true;
};

MY.Menu.prototype.init = function () {    
    // TODO: Post tab/iframe settings from constructure using a config object, 
    // so that tokens like "Home" are in the same file. 
    this.initTab(0,"Welcome","Welcome.html",true);
    this.initTab(1,"Contacts","Contacts.html",false);
    this.initTab(2,"Notes","../jsnotes/index.html",false);
    this.initTab(3,"Log","Log.html",true);
    var onActiveTabChange = function(e) {
        var nIndex = this.get('activeIndex');
        this.oMenu.setTitle(nIndex);
	};
    this.oTabView.on('activeTabChange', onActiveTabChange);     
};
}}}


|| [http://code.google.com/p/yazaar/issues/detail?id=25 Issue 25] ||


