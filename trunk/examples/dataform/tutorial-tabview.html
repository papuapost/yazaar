<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>DataForm with TabView</title>
  </head>
  <body>

    <p>
      Welcome to the DataForm test page.
    </p>

    <ul>
      <li>
        A DataForm edits a single record at a time in a vertical form, as opposed to a tabular format.
        It is a custom Yazaar widget designed to complement the YUI DataTable.
        A DataForm can share a DataSource and ColumnSet with a DataTable, so that the two widgets can be used in tandem.
      </li>
      <li>
        A FLEV widget is being designed which uses a DataForm, DataTable, and TabView to create a unified Find, List, Edit, View workflow.
      </li>
      <li>
        This example utilizes the test data from the <a href="test-datatable.html"> DataTable</a> documentation.
      </li>
    </ul>

    <hr />

    <table cellspacing="16">
      <tr><td valign="top" width="98%">
        <div id="elTabView" class="yui-navset">
            <ul class="yui-nav">
                <li class="selected"><a href="#tab1"><em>List (DataTable)</em></a></li>
                <li><a href="#tab2"><em>Edit (DataForm)</em></a></li>
            </ul>
            <div class="yui-content">
            <div id="elDataTable" class="yui_datatable"></div>
            <div id="elDataForm"></div>
            </div>
        </div>
      </td><td>
        <div id="elLogReader"></div>
      </td></tr>
    </table>
    
        <div class="ac">
           <p style="font-weight: bold;">Find a dog:</p>
            <div class="acF">
                <input class="acInput" id="acInput1">
                <div class="acResult" id="acResult1"></div>
            </div>
        </div>          
    
  </body>

<!-- DataTable/DataForm -->
<!-- Required CSS -->
<link type="text/css" rel="stylesheet" href="http://yui.yahooapis.com/2.2.0/build/datatable/assets/datatable.css">
<!-- Dependencies -->
<script src="http://yui.yahooapis.com/2.2.0/build/yahoo-dom-event/yahoo-dom-event.js"></script>
<!-- OPTIONAL: Connection (enables XHR) -->
<script src="http://yui.yahooapis.com/2.2.0/build/connection/connection-min.js"></script>
<!-- OPTIONAL: Drag Drop (enables resizeable columns) -->
<script src="http://yui.yahooapis.com/2.2.0/build/dragdrop/dragdrop-min.js"></script>
<!-- OPTIONAL: External JSON parser from http://www.json.org/ (enables JSON validation) -->
<script src="http://www.json.org/json.js"></script>
<!-- YUI Source files -->
<script src="http://yui.yahooapis.com/2.2.0/build/datasource/datasource-beta-min.js"></script>
<script src="http://yui.yahooapis.com/2.2.0/build/datatable/datatable-beta-min.js"></script>

<!-- Dependencies for Context Menu -->
<!--CSS-->
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.2.0/build/reset/reset-min.css">
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.2.0/build/fonts/fonts-min.css">
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.2.0/build/menu/assets/menu.css">
<script type="text/javascript" src="http://yui.yahooapis.com/2.2.0/build/container/container_core-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.2.0/build/menu/menu-min.js"></script>
<!-- End dependencies for Context Menu -->

<!-- Dependencies for Autocomplete -->
<!-- Source file -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.2.0/build/autocomplete/autocomplete-min.js"></script>
<!-- End dependencies for Autocomplete -->

<!-- DPU RowFilterTable source (extends YUI version) -->
<!-- CSS -->
<style type="text/css">
    /* custom css*/
    body {font-family:arial}
    /* CSS FOR DataTable */
    div.yui_datatable {margin:1em;}
    div.yui_datatable table {border-collapse:collapse;}
    div.yui_datatable th, div.yui_datatable td {border:1px solid #F1EFE2;padding:.25em; text-align:center; }
    div.yui_datatable th {border-bottom:2px solid #D6D2C2; cursor:default;  font-family:arial;   font-size:8pt;  font-size-adjust:none; line-height:normal; background-color:#EBEADB;}
    div.yui_datatable th img {border-style:none}
    div.yui_datatable th a   {text-decoration:none; color:black; font-weight:normal}
    div.yui_datatable th a:hover {text-decoration:underline; }  
    div.yui_datatable em {font-style:italic;}
    div.yui_datatable strong {font-weight:bold;}
    div.yui_datatable .big {font-size:136%;}
    div.yui_datatable .small {font-size:77%}
    div.yui_datatable .yui-dt-sortedbyasc .yui-dt-headtext {background-image: url('assets/sort_asc.gif'); background-repeat:no-repeat; background-position:right;}/*arrow up*/ 
    div.yui_datatable .yui-dt-sortedbydesc .yui-dt-headtext {background-image: url('assets/sort_desc.gif'); background-repeat:no-repeat; background-position:right;}/*arrow down*/
    div.yui_datatable th .yui-dt-headtext {margin-right:5px;padding-right:15px;} /*room for arrow*/     

    /*CSS For Auto Complete*/
    .ac {position:relative;padding:1em;}
    .acF {position:relative;margin:1em;width:15em;}/* set width of widget here*/
    .acInput {position:absolute;width:100%;height:1.4em;}
    .acResult {position:absolute;top:1.7em;width:100%;}
    .acResult .yui-ac-content {position:absolute;width:100%;height:11em;border:1px solid #404040;background:#fff;overflow:auto;overflow-x:hidden;z-index:9050;}
    .acResult .yui-ac-shadow {position:absolute;margin:.3em;width:100%;background:#a0a0a0;z-index:9049;}
    .acResult ul {padding:5px 0;width:100%;}
    .acResult li {padding:0 5px;cursor:default;white-space:nowrap; font-size:small}
    .acResult li.yui-ac-highlight {background:#ff0;}
</style>            
<script type="text/javascript" src="../../../build/extras/dpu/RowFilterDataTable.js" ></script>
<script type="text/javascript" src="../../../build/extras/dpu/RowFilter.js" ></script>
<!-- Yazaar Source files -->
<script src="../../build/dataform/dataform-debug-beta.js"></script>
<!-- OPTIONAL: jc21 validator -->
<script src="../../build/extras/jc21/validate-min.js"></script>

<!-- TabView -->
<!-- Required CSS -->
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.2.0/build/tabview/assets/tabview.css">
<script src="http://yui.yahooapis.com/2.2.0/build/element/element-beta-min.js"></script>
<!-- OPTIONAL: skin for border tabs -->
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.2.0/build/tabview/assets/border_tabs.css">
<!-- Source file -->
<script src="http://yui.yahooapis.com/2.2.0/build/tabview/tabview-min.js"></script>

<!-- LogReader -->
<!-- Required CSS -->
<link type="text/css" rel="stylesheet" href="http://yui.yahooapis.com/2.2.0/build/logger/assets/logger.css">
<!-- Source file -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.2.0/build/logger/logger-min.js"></script>
<script type="text/javascript">
  var oLogReader = new YAHOO.widget.LogReader("elLogReader");
</script>

    <style type="text/css">
        #elDataTable {margin:1em;}
        #elDataTable table {border-collapse:collapse;}
        #elDataTable th, #elDataTable td {border:1px solid #000;padding:.25em;}
        #elDataTable th {background-color:#BEDAFF}
        #elDataTable.yui-dt-odd {background-color:#eee;} /*light gray*/
        #elDataTable em {font-style:italic;}
        #elDataTable strong {font-weight:bold;}
        #elDataTable .big {font-size:136%;}
        #elDataTable .small {font-size:77%}
        #elDataTable .yui-dt-selected {background-color:#000;color:#FFF;} /*white on black*/
        #elDataTable .yui-dt-editable.yui-dt-highlight {background-color:#BEDAFF;} /*light blue*/
  </style>

<!-- Page script -->
<script type="text/javascript">

var oTabView = new YAHOO.widget.TabView("elTabView");

var oColumnHeaders = [
    {key:"name", text:"Dog's Name", formClassName: "required", formTitle: "Dog's Name is required"},
    {key:"breed", text:"Dog's Breed", formClassName: "required", formTitle: "Dog's Breed is required"},
    {key:"age", text:"Dog's Age (in Weeks)", type:"number", formClassName: "validate-number", formTitle: "Enter Dog's Age in number of weeks"}
];
var oColumnSet = new YAHOO.widget.ColumnSet(oColumnHeaders);

YAHOO.example.oPuppies = [
   {name:"Ashley",breed:"German Shepherd",age:12},
   {name:"Dirty Harry",breed:"Norwich Terrier",age:5},
   {name:"Emma",breed:"Labrador Retriever",age:9},
   {name:"Oscar",breed:"Yorkshire Terrier",age:6},
   {name:"Riley",breed:"Golden Retriever",age:6},
   {name:"Shannon",breed:"Greyhound",age:12},
   {name:"Washington",breed:"English Bulldog",age:8},
   {name:"Zoe",breed:"Labrador Retriever",age:3}
];

var oDataSource = new YAHOO.util.DataSource(YAHOO.example.oPuppies);
oDataSource.responseType = YAHOO.util.DataSource.TYPE_JSARRAY;
oDataSource.responseSchema = {
    fields: ["name","breed","age"]
};

var oDataTable = new YAHOO.dpu.widget.DataTable("elDataTable", oColumnSet, oDataSource, {rowSingleSelect: true});
// Enable Row Selection
oDataTable.subscribe("cellClickEvent",oDataTable.onEventSelectRow);
oDataTable.select(oDataTable.getRow(0));

// Create our own event for selecting the record behind a row
oDataTable.createEvent("recordSelectEvent");

// Raise our event when a row is selected
var onRowClickEvent = function(oArgs) {

  var dt = oDataTable;
    var rs = dt.getRecordSet();
    var row = dt.getSelectedRecordIds();
    if (row.length===0) {
        dt.getRow(0); // No row was selected
        row = dt.getSelectedRecordIds();
    }
    var oRecord = rs.getRecord(row[row.length-1]); // ISSUE: Returns row selected on each page

  // Raise RecordSelectEvent with payload
    this.fireEvent("recordSelectEvent",{record:oRecord});
  YAHOO.log("Selected Record: " + oRecord.toJSONString());
}
oDataTable.subscribe("cellClickEvent", onRowClickEvent);

var oConfigs = {oDataTable: oDataTable};
var oDataForm = new YAHOO.yazaar.widget.DataForm("elDataForm", oColumnSet, oDataSource, oConfigs);

// Goto to DataForm
var onRecordSelectEvent = function () {
  oDataForm.populateForm();
    oTabView.set('activeIndex', 1);
}
oDataTable.subscribe("recordSelectEvent", onRecordSelectEvent);

// Goto DataTable
var onRecordActionEvent = function () {
  oTabView.set('activeIndex', 0);
}
oDataForm.subscribe("updateEvent", onRecordActionEvent);
oDataForm.subscribe("cancelEvent", onRecordActionEvent);

// Prompt before changing tabs
var onBeforeActiveTabChange = function(e) {
  var isChanged = oDataForm.isRecordChanged();
  if (isChanged) {
    return (confirm("Exit form without saving?"));
  } else {
    return true;
  }
};
oTabView.on('beforeActiveTabChange', onBeforeActiveTabChange);


// Setup filter 
fnFilter= new YAHOO.dpu.util.StringFilter(YAHOO.example.oPuppies,"name")
fnFilter.maxCacheEntries = 0;
oAutoComp = new YAHOO.dpu.widget.RowFilter('acInput1','acResult1', oDataTable,fnFilter);
var ua = navigator.userAgent.toLowerCase();
if(ua.indexOf('msie') != -1 && ua.indexOf('opera') < 0) {
        oAutoComp.useIFrame = true;    
}


</script>

</html>
